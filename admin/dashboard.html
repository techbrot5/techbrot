<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dashboard — TechBrot Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/admin/dashboard.css">
</head>

<body>
  <header class="header">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="brand">TechBrot Admin</div>
        <div class="small">/dashboard</div>
      </div>

      <div style="display:flex;gap:10px;align-items:center">
        <div id="adminStatus" class="small">Locked</div>
        <button id="lockBtn" class="btn ghost">Lock</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="card">

      <!-- FILTERS & SEARCH -->
      <div class="filter-row" style="justify-content:space-between">
        <div style="display:flex;gap:8px;align-items:center;flex:1">
          <input id="q" class="input" placeholder="Search order id, email, stripe session..." style="flex:1" />
          <select id="filter" class="input">
            <option value="">All</option>
            <option value="verified">Verified</option>
            <option value="unverified">Unverified</option>
          </select>

          <input id="fromDate" type="date" class="input" />
          <input id="toDate" type="date" class="input" />

          <input id="minAmount" class="input" placeholder="Min amount" style="width:120px" />
          <input id="maxAmount" class="input" placeholder="Max amount" style="width:120px" />

          <button id="searchBtn" class="btn">Search</button>
        </div>

        <div style="display:flex;gap:8px">
          <button id="exportAllBtn" class="btn secondary">Export All (ZIP)</button>
          <button id="verifyAllBtn" class="btn secondary" style="background:#444;color:#fff">
            Verify ALL Evidence
          </button>
          <button id="deleteEvidenceBtn" class="btn secondary" style="background:#b30000;color:#fff">
            Delete Evidence
          </button>
          <button id="loginBtn" class="btn ghost">Unlock</button>
        </div>
      </div>

      <!-- RESULTS TABLE -->
      <div class="table-wrap" style="margin-top:12px">
        <table id="resultsTable" aria-live="polite">
          <thead>
            <tr>
              <th>Order ID</th><th>Email</th><th>Amount</th><th>Currency</th>
              <th>Verified</th><th>Created</th><th>Risk</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="resultsBody">
            <tr><td colspan="8" class="small">Enter PIN to unlock dashboard and search orders.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="footer small">PIN-based admin. Keep PIN secret. Uses Cloudflare D1 & R2.</div>
    </div>
  </main>

  <!-- ========================================================= -->
  <!-- PROGRESS MODAL (Verify ALL Evidence) -->
  <!-- ========================================================= -->
  <div id="progressModal" style="
      position:fixed;left:0;top:0;width:100%;height:100%;
      background:rgba(0,0,0,0.45);display:none;
      align-items:center;justify-content:center;z-index:9999;">
    <div style="background:#fff;padding:24px;border-radius:10px;max-width:650px;width:90%;
      box-shadow:0 8px 30px rgba(0,0,0,0.25)">
      <h3>Processing Evidence…</h3>
      <pre id="progressLog" style="
        background:#f6f6f6;padding:12px;height:300px;overflow:auto;
        border-radius:6px;font-size:13px;"></pre>
      <button id="closeProgressBtn" class="btn" style="margin-top:12px;background:#444;color:#fff">
        Close
      </button>
    </div>
  </div>

  <!-- ========================================================= -->
  <!-- DELETE EVIDENCE MODAL -->
  <!-- ========================================================= -->
  <div id="deleteModal" style="
      position:fixed;left:0;top:0;width:100%;height:100%;
      background:rgba(0,0,0,0.45);display:none;
      align-items:center;justify-content:center;z-index:9999;">
    <div style="
        background:#fff;padding:24px;border-radius:10px;
        max-width:420px;width:90%;box-shadow:0 8px 30px rgba(0,0,0,0.25)">
      <h3>Delete Order Evidence</h3>
      <p class="small muted">This deletes R2 evidence only (JSON logs, emails, verification).  
      It does NOT remove DB rows.</p>

      <label>Order ID</label>
      <input id="deleteOrderInput" class="input" style="margin-top:6px;width:100%" />

      <button id="deleteConfirmBtn" class="btn" style="margin-top:12px;background:#b30000;color:#fff;width:100%">
        Delete Evidence
      </button>

      <button id="deleteCancelBtn" class="btn secondary" style="margin-top:8px;width:100%">
        Cancel
      </button>

      <pre id="deleteResult" style="
        display:none;margin-top:14px;background:#f6f6f6;padding:12px;
        border-radius:6px;max-height:240px;overflow:auto;font-size:13px"></pre>
    </div>
  </div>

  <script src="/admin/dashboard.js"></script>
</body>
</html>
