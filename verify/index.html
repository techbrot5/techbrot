<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Verify Order — TechBrot</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:Inter,system-ui,Arial;margin:20px;color:#111;background:#f6f7f8}
    .card{max-width:720px;margin:36px auto;padding:28px;border-radius:10px;background:#fff;box-shadow:0 8px 30px rgba(2,6,23,0.06)}
    button{background:#0fd46c;border:none;padding:12px 16px;border-radius:8px;color:#042;cursor:pointer;font-weight:600}
    a.button{display:inline-block;padding:12px 16px;border-radius:8px;background:#0fd46c;color:#042;text-decoration:none}
  </style>
</head>
<body>
  <div class="card">
    <h1>Verify & Authorize your order</h1>
    <p id="desc">Click the button below to confirm you authorized this payment and accept the service terms.</p>
    <div id="result"></div>
    <div style="margin-top:18px">
      <button id="verifyBtn">Verify my order</button>
    </div>
  </div>

<script>
(async function(){
  const params = new URLSearchParams(location.search);
  const orderId = params.get('order_id');
  const token = params.get('token');
  const btn = document.getElementById('verifyBtn');
  const resEl = document.getElementById('result');

  if (!orderId || !token) {
    resEl.innerText = 'Missing or invalid verification link. Contact support.';
    btn.disabled = true;
    return;
  }

  async function doVerify() {
    btn.disabled = true;
    resEl.innerText = 'Verifying...';
    try {
      const r = await fetch('/api/verify-order', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ order_id: orderId, token })
      });
      const j = await r.json();
      if (r.ok && j && j.ok) {
        resEl.innerHTML = '<strong>Verified — thank you.</strong><p>We recorded your confirmation.</p>';
      } else {
        resEl.innerText = 'Verification failed: ' + (j && j.error ? j.error : 'unknown error. Contact support.');
      }
    } catch (e) {
      resEl.innerText = 'Network error. Try again later.';
    }
  }

  btn.addEventListener('click', doVerify);
})();
</script>
</body>
</html>
