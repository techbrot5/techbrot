<!-- START: Standalone Firm Connect product (Hosted Checkout) -->
<div id="firm-connect-card" style="max-width:360px;border:1px solid #e6e6e6;border-radius:10px;padding:16px;font-family:system-ui,Segoe UI,Roboto,Arial">
  <h3 style="margin:0 0 6px 0">Firm Connect — Secure firm link</h3>
  <div style="color:#555;margin-bottom:8px">Light ongoing access, secure uploads, and priority booking.</div>

  <div style="display:flex;align-items:baseline;gap:8px;margin-bottom:6px">
    <div id="fc-price-top" style="font-weight:800;font-size:1.4rem">$4.99</div>
    <div id="fc-price-sub" style="color:#666">/mo</div>
  </div>

  <div style="margin-bottom:8px">
    <label style="display:block;cursor:pointer;margin-bottom:6px">
      <input type="radio" name="firm-billing-standalone" value="monthly" checked> &nbsp;Monthly — $4.99 / mo
    </label>
    <label style="display:block;cursor:pointer">
      <input type="radio" name="firm-billing-standalone" value="annual"> &nbsp;Annual — $41.94 / year (30% off)
    </label>
  </div>

  <div style="color:#444;font-size:.95rem;margin-bottom:12px">
    Includes secure document uploads, a member-only support channel, and priority booking for paid services.
  </div>

  <button id="fc-buy" style="background:#0d6efd;color:#fff;border:none;padding:10px 12px;border-radius:8px;width:100%;font-weight:700;cursor:pointer">
    Buy Now
  </button>

  <div id="fc-msg" style="margin-top:10px;color:#555;font-size:.9rem"></div>
</div>

<script>
/*
Standalone Firm Connect card
- Sends { product: 'firmconnect', billing: 'monthly' } to your create-checkout-session worker
- Expects JSON response: { url: "<stripe_checkout_session_url>" }
- Adjust CREATE_SESSION_ENDPOINT to your deployed worker path if necessary
*/

const CREATE_SESSION_ENDPOINT = '/api/create-checkout-session' // <-- change to your worker path if needed
const card = document.getElementById('firm-connect-card')
const priceTop = document.getElementById('fc-price-top')
const priceSub = document.getElementById('fc-price-sub')
const buyBtn = document.getElementById('fc-buy')
const msg = document.getElementById('fc-msg')

// helper: update top price display when radios change
function updatePriceDisplay() {
  const billing = document.querySelector('input[name="firm-billing-standalone"]:checked').value
  if (billing === 'monthly') {
    priceTop.textContent = '$4.99'
    priceSub.textContent = '/mo'
  } else {
    // annual = monthly * 12 * 0.7
    const annual = +(4.99 * 12 * 0.7).toFixed(2)
    priceTop.textContent = '$' + annual
    priceSub.textContent = '/yr'
  }
}

// attach radio change events
document.querySelectorAll('input[name="firm-billing-standalone"]').forEach(r => r.addEventListener('change', updatePriceDisplay))
updatePriceDisplay()

// Buy button handler
buyBtn.addEventListener('click', async () => {
  msg.style.color = '#444'
  msg.textContent = 'Redirecting to checkout…'
  buyBtn.disabled = true

  const billing = document.querySelector('input[name="firm-billing-standalone"]:checked').value

  try {
    // POST minimal payload your worker expects
    const res = await fetch(CREATE_SESSION_ENDPOINT, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ product: 'firmconnect', billing }) // worker normalizes to 'firmconnect_monthly' etc
    })

    if (!res.ok) {
      const txt = await res.text()
      throw new Error(txt || 'Failed creating checkout session')
    }

    const data = await res.json()
    if (data && data.url) {
      // redirect to Stripe Hosted Checkout
      window.location.href = data.url
      return
    } else {
      throw new Error('No checkout url returned')
    }
  } catch (err) {
    console.error('Checkout error', err)
    msg.style.color = 'red'
    msg.textContent = 'Checkout failed — try again or contact support.'
    buyBtn.disabled = false
  }
})
</script>
<!-- END: Standalone Firm Connect product -->
